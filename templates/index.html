<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üö® Dual Model Sepsis Risk Prediction System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p { font-size: 1.2rem; opacity: 0.9; }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeInUp 0.8s ease-out;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group { display: flex; flex-direction: column; }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input::placeholder { color: #999; font-style: italic; font-size: 0.9rem; }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .section-title {
            color: #667eea;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .btn-container { display: flex; gap: 15px; margin-top: 30px; }

        .btn {
            flex: 1;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-predict {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-predict:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }

        .btn-reset { background: #6c757d; color: white; }
        .btn-reset:hover { background: #5a6268; }

        /* ========== DUAL MODEL RESULTS ========== */
        .result-container {
            margin-top: 30px;
            padding: 30px;
            border-radius: 15px;
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .result-high-risk {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .result-medium-risk {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
            color: #1f1f1f;
        }

        .result-low-risk {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
        }

        /* Override white text for child elements in .result-low-risk */
        .result-low-risk .model-card,
        .result-low-risk .final-assessment,
        .result-low-risk .clinical-note,
        .result-low-risk .abnormal-values {
            color: #333;
        }

        .result-low-risk .model-card h3,
        .result-low-risk .final-assessment h3,
        .result-low-risk .clinical-note,
        .result-low-risk .abnormal-values h3 {
            color: #333;
        }

        .result-low-risk .model-score {
            color: #222;
        }

        .result-low-risk .model-threshold {
            color: #666;
        }

        /* Also override for other risk levels if needed */
        .result-high-risk .model-card,
        .result-high-risk .final-assessment,
        .result-high-risk .clinical-note,
        .result-high-risk .abnormal-values {
            color: #333;
        }

        .result-high-risk .model-card h3,
        .result-high-risk .final-assessment h3,
        .result-high-risk .clinical-note,
        .result-high-risk .abnormal-values h3 {
            color: #333;
        }

        .result-title {
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .model-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .model-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .model-card.warning {
            border-left: 6px solid #ffc107;
        }

        .model-card.confirmation {
            border-left: 6px solid #0dcaf0;
        }

        .model-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .model-score {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .model-threshold {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .model-status {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .status-risky {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .status-safe {
            background: rgba(81, 207, 102, 0.2);
            color: #37b24d;
        }

        .final-assessment {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 6px solid #667eea;
        }

        .clinical-note {
            background: rgba(13, 202, 240, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #0dcaf0;
            font-size: 0.95rem;
            line-height: 1.6;
            white-space: pre-line;
        }
        /* ========== LOADING & ERRORS ========== */
        .loading { 
            display: none; 
            text-align: center; 
            padding: 30px; 
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }

        .error-message {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            animation: shake 0.5s ease-out;
        }

        @keyframes shake { 
            0%, 100% { transform: translateX(0); } 
            25% { transform: translateX(-10px); } 
            75% { transform: translateX(10px); } 
        }

        .info-badge {
            display: inline-block;
            background: #e7f3ff;
            color: #0066cc;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.85rem;
            margin-left: 8px;
            font-weight: 500;
        }

        .abnormal-values {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            border-left: 4px solid #0dcaf0;
        }

        .abnormal-values h3 { 
            font-size: 1.3rem; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }

        .abnormal-list { list-style: none; padding: 0; }

        .abnormal-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .show-details-btn {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
            display: none;
        }

        .show-details-btn:hover { 
            background: rgba(255, 255, 255, 0.5); 
            transform: translateY(-2px); 
        }

        .hidden { display: none; }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .form-grid { grid-template-columns: 1fr; }
            .btn-container { flex-direction: column; }
            .model-comparison { grid-template-columns: 1fr; }
        }

        .example-btn {
            background: #17a2b8;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .example-btn:hover { 
            background: #138496; 
            transform: translateY(-2px); 
        }

        .risk-explanation {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #6f42c1;
        }

        .risk-explanation h4 {
            color: #6f42c1;
            margin-bottom: 10px;
        }

        .risk-explanation ul {
            padding-left: 20px;
        }

        .risk-explanation li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üö® Dual Model Sepsis Risk Prediction</h1>
            <p>Two-stage assessment: Warning Model + Confirmation Model</p>

            <div style="background: rgba(255, 255, 255, 0.95); color: #333; padding: 20px; border-radius: 15px; margin-top: 20px; max-width: 900px; margin-left: auto; margin-right: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                <h3 style="color: #667eea; margin-bottom: 12px; font-size: 1.3rem;">üéØ Dual Model Clinical Decision Support</h3>
                <p style="line-height: 1.8; font-size: 1rem; margin-bottom: 10px;">
                    <strong>Stage 1 - Warning Model:</strong> High recall  screening to catch most sepsis cases<br>
                    <strong>Stage 2 - Confirmation Model:</strong> High precision diagnosis for confirmed cases
                </p>
                <p style="line-height: 1.8; font-size: 1rem; color: #666;">
                    <strong>‚ö†Ô∏è Clinical Note:</strong> This is a decision support tool. Always use clinical judgment alongside model predictions.
                </p>
            </div>
        </div>
        
        <div class="risk-explanation">
            <h4>üìä How the Dual Model System Works:</h4>
            <ul>
                <li><strong>‚ö†Ô∏è Warning Model :</strong> Screens for potential sepsis. May have false alarms but catches most cases.</li>
                <li><strong>‚úÖ Confirmation Model :</strong> Confirms high-risk cases. When it predicts sepsis.</li>
                <li><strong>üéØ Combined Decision:</strong> Both models work together for more reliable risk assessment.</li>
            </ul>
        </div>

        <div class="card">
            <button class="example-btn" onclick="fillExampleData()">üìã Load Example Patient Data</button>

            <form id="predictionForm">
                <div class="section-title">üë§ Patient Demographics</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="anchor_age">Age <span class="info-badge">Years</span></label>
                        <input type="number" id="anchor_age" name="anchor_age" min="0" max="120" placeholder="e.g., 64" required />
                    </div>

                    <div class="form-group">
                        <label for="gender">Gender <span class="info-badge">0/1</span></label>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="0">Female (0)</option>
                            <option value="1">Male (1)</option>
                        </select>
                    </div>
                </div>

                <div class="section-title">üìä ICU Vital Signs</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="hr">Heart Rate <span class="info-badge">bpm</span></label>
                        <input type="number" step="0.01" id="hr" name="hr" placeholder="e.g., 112" required />
                    </div>

                    <div class="form-group">
                        <label for="map">Mean Arterial Pressure (MAP) <span class="info-badge">mmHg</span></label>
                        <input type="number" step="0.01" id="map" name="map" placeholder="e.g., 68" required />
                    </div>

                    <div class="form-group">
                        <label for="rr">Respiratory Rate <span class="info-badge">/min</span></label>
                        <input type="number" step="0.01" id="rr" name="rr" placeholder="e.g., 24" required />
                    </div>

                    <div class="form-group">
                        <label for="temp_c">Temperature <span class="info-badge">¬∞C</span></label>
                        <input type="number" step="0.01" id="temp_c" name="temp_c" placeholder="e.g., 38.4" required />
                    </div>

                    <div class="form-group">
                        <label for="spo2">SpO2 <span class="info-badge">%</span></label>
                        <input type="number" step="0.01" id="spo2" name="spo2" min="0" max="100" placeholder="e.g., 92" required />
                    </div>
                </div>

                <div class="section-title">üî¨ Labs & Organ Dysfunction Markers</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="creatinine">Creatinine <span class="info-badge">mg/dL</span></label>
                        <input type="number" step="0.01" id="creatinine" name="creatinine" placeholder="e.g., 2.1" required />
                    </div>

                    <div class="form-group">
                        <label for="bilirubin">Bilirubin <span class="info-badge">mg/dL</span></label>
                        <input type="number" step="0.01" id="bilirubin" name="bilirubin" placeholder="e.g., 1.8" required />
                    </div>

                    <div class="form-group">
                        <label for="platelets">Platelets <span class="info-badge">K/uL</span></label>
                        <input type="number" step="0.01" id="platelets" name="platelets" placeholder="e.g., 95" required />
                    </div>

                    <div class="form-group">
                        <label for="lactate">Lactate <span class="info-badge">mmol/L</span></label>
                        <input type="number" step="0.01" id="lactate" name="lactate" placeholder="e.g., 3.6" required />
                    </div>

                    <div class="form-group">
                        <label for="urine_output_6h_ml">Urine Output (6h) <span class="info-badge">mL</span></label>
                        <input type="number" step="0.01" id="urine_output_6h_ml" name="urine_output_6h_ml" placeholder="e.g., 210" required />
                    </div>
                </div>

                <div class="btn-container">
                    <button type="submit" class="btn btn-predict">üîç Analyze Sepsis Risk</button>
                    <button type="reset" class="btn btn-reset">üîÑ Reset Form</button>
                </div>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing with Dual Model System...</p>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <!-- ========== DUAL MODEL RESULTS ========== -->
            <div class="result-container" id="resultContainer">
                <h2 class="result-title" id="resultTitle"></h2>
                
                <!-- Model Comparison -->
                <div class="model-comparison" id="modelComparison">
                    <div class="model-card warning">
                        <h3>‚ö†Ô∏è Warning Model <span style="font-size: 0.8rem; background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 10px;"> Recall</span></h3>
                        <div class="model-score" id="warningScore">0%</div>
                        <div class="model-threshold">Threshold: <span id="warningThreshold">46.5%</span></div>
                        <div class="model-status" id="warningStatus">Safe</div>
                        <p style="font-size: 0.9rem; margin-top: 10px; color: #666;">Screening for potential sepsis cases</p>
                    </div>
                    
                    <div class="model-card confirmation">
                        <h3>‚úÖ Confirmation Model <span style="font-size: 0.8rem; background: #d1ecf1; color: #0c5460; padding: 2px 8px; border-radius: 10px;"> Precision</span></h3>
                        <div class="model-score" id="confirmationScore">0%</div>
                        <div class="model-threshold">Threshold: <span id="confirmationThreshold">43.3%</span></div>
                        <div class="model-status" id="confirmationStatus">Safe</div>
                        <p style="font-size: 0.9rem; margin-top: 10px; color: #666;">Confirming high-risk sepsis cases</p>
                    </div>
                </div>

                <!-- Final Assessment -->
                <div class="final-assessment">
                    <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        üéØ Combined Assessment
                    </h3>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 2.5rem; font-weight: 700;" id="consensusScore">0%</div>
                            <div style="font-size: 0.9rem; color: #666;">Consensus Risk Score</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: 600;" id="riskLevel">LOW RISK</div>
                            <div style="font-size: 1rem; color: #666;" id="riskLabel">Low risk of sepsis</div>
                        </div>
                    </div>
                </div>

                <!-- Clinical Note -->
                <div class="clinical-note" id="clinicalNote">
                    Clinical note will appear here...
                </div>

                <!-- Abnormal Values -->
                <div class="abnormal-values hidden" id="abnormalValues">
                    <h3>üìå Abnormal Values Detected</h3>
                    <ul class="abnormal-list" id="abnormalList"></ul>
                </div>

                <button class="show-details-btn" id="showDetailsBtn" onclick="toggleAbnormalValues()">
                    Show Detailed Values
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/predict';

        // Clinical thresholds for UI notes
        const ranges = {
            hr: { min: 60, max: 100, label: "Heart Rate", unit: "bpm" },
            map: { min: 65, max: 120, label: "MAP", unit: "mmHg" },
            rr: { min: 12, max: 20, label: "Respiratory Rate", unit: "/min" },
            temp_c: { min: 36.1, max: 37.8, label: "Temperature", unit: "¬∞C" },
            spo2: { min: 95, max: 100, label: "SpO2", unit: "%" },
            creatinine: { min: 0.4, max: 1.2, label: "Creatinine", unit: "mg/dL" },
            bilirubin: { min: 0.1, max: 1.2, label: "Bilirubin", unit: "mg/dL" },
            platelets: { min: 150, max: 450, label: "Platelets", unit: "K/uL" },
            lactate: { min: 0.5, max: 2.0, label: "Lactate", unit: "mmol/L" },
            urine_output_6h_ml: { min: 300, max: 5000, label: "Urine Output (6h)", unit: "mL" }
        };

        function checkAbnormalValues(data) {
            const abnormal = [];
            for (const [key, value] of Object.entries(data)) {
                if (ranges[key]) {
                    const r = ranges[key];
                    if (value < r.min || value > r.max) {
                        abnormal.push({
                            label: r.label, value, unit: r.unit,
                            min: r.min, max: r.max,
                            status: value < r.min ? "Low" : "High"
                        });
                    }
                }
            }
            return abnormal;
        }

        function displayNotes(abnormalValues) {
            const list = document.getElementById('abnormalList');
            const box = document.getElementById('abnormalValues');
            const btn = document.getElementById('showDetailsBtn');

            if (abnormalValues.length === 0) {
                btn.style.display = "none";
                box.classList.add("hidden");
                return;
            }

            list.innerHTML = '';
            abnormalValues.forEach(item => {
                const li = document.createElement('li');
                li.className = 'abnormal-item';
                li.innerHTML = `
                    <span><strong>${item.label}:</strong> ${item.value} ${item.unit}</span>
                    <span style="font-size: 0.9em; opacity: 0.9;">
                        ${item.status} (Ref: ${item.min} - ${item.max} ${item.unit})
                    </span>
                `;
                list.appendChild(li);
            });

            btn.style.display = "inline-block";
            box.classList.add("hidden");
        }

        function toggleAbnormalValues() {
            const box = document.getElementById('abnormalValues');
            const btn = document.getElementById('showDetailsBtn');

            if (box.classList.contains('hidden')) {
                box.classList.remove('hidden');
                btn.textContent = "Hide Detailed Values";
            } else {
                box.classList.add('hidden');
                btn.textContent = "Show Detailed Values";
            }
        }

        function fillExampleData() {
            // High risk example
            document.getElementById('hr').value = 140;
            document.getElementById('map').value = 55;
            document.getElementById('rr').value = 32;
            document.getElementById('temp_c').value = 39.8;
            document.getElementById('spo2').value = 85;
            document.getElementById('creatinine').value = 3.5;
            document.getElementById('bilirubin').value = 3.2;
            document.getElementById('platelets').value = 50;
            document.getElementById('lactate').value = 5.8;
            document.getElementById('urine_output_6h_ml').value = 100;
            document.getElementById('anchor_age').value = 72;
            document.getElementById('gender').value = 1;
        }

        function getRiskClass(riskLevel) {
            switch(riskLevel) {
                case 'HIGH_RISK_CONFIRMED':
                    return 'result-high-risk';
                case 'MODERATE_RISK':
                    return 'result-medium-risk';
                case 'LOW_RISK_WARNING':
                case 'LOW_RISK':
                default:
                    return 'result-low-risk';
            }
        }

        function getRiskTitle(riskLevel) {
            switch(riskLevel) {
                case 'HIGH_RISK_CONFIRMED':
                    return 'üö® HIGH RISK - SEPSIS CONFIRMED';
                case 'MODERATE_RISK':
                    return 'üü° MODERATE RISK - MONITOR CLOSELY';
                case 'LOW_RISK_WARNING':
                    return 'üîî LOW RISK - WARNING DETECTED';
                case 'LOW_RISK':
                default:
                    return '‚úÖ LOW RISK - NO SEPSIS DETECTED';
            }
        }

        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const loading = document.getElementById('loading');
            const resultContainer = document.getElementById('resultContainer');
            const errorMessage = document.getElementById('errorMessage');

            resultContainer.style.display = 'none';
            errorMessage.style.display = 'none';
            loading.style.display = 'block';

            const formData = new FormData(e.target);
            const payload = {};
            
            formData.forEach((value, key) => {
                if (key === "gender" || key === "anchor_age") {
                    payload[key] = parseInt(value, 10);
                } else {
                    payload[key] = parseFloat(value);
                }
            });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                loading.style.display = 'none';

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.detail || "Prediction failed");
                }

                const result = await response.json();

                // Update UI with dual model results
                resultContainer.style.display = 'block';
                
                // Set overall risk styling
                const riskClass = getRiskClass(result.risk_level);
                resultContainer.className = `result-container ${riskClass}`;
                
                // Update titles
                document.getElementById('resultTitle').textContent = getRiskTitle(result.risk_level);
                
                // Update model scores
                document.getElementById('warningScore').textContent = `${(result.warning_model_score * 100).toFixed(1)}%`;
                document.getElementById('warningThreshold').textContent = `${(result.warning_threshold * 100).toFixed(1)}%`;
                
                document.getElementById('confirmationScore').textContent = `${(result.confirmation_model_score * 100).toFixed(1)}%`;
                document.getElementById('confirmationThreshold').textContent = `${(result.confirmation_threshold * 100).toFixed(1)}%`;
                
                // Update status indicators
                const warningStatus = document.getElementById('warningStatus');
                const confirmationStatus = document.getElementById('confirmationStatus');
                
                if (result.warning_model_score >= result.warning_threshold) {
                    warningStatus.textContent = 'RISK DETECTED';
                    warningStatus.className = 'model-status status-risky';
                } else {
                    warningStatus.textContent = 'NO RISK';
                    warningStatus.className = 'model-status status-safe';
                }
                
                if (result.confirmation_model_score >= result.confirmation_threshold) {
                    confirmationStatus.textContent = 'CONFIRMED';
                    confirmationStatus.className = 'model-status status-risky';
                } else {
                    confirmationStatus.textContent = 'NOT CONFIRMED';
                    confirmationStatus.className = 'model-status status-safe';
                }
                
                // Update consensus score
                document.getElementById('consensusScore').textContent = `${(result.sepsis_risk_score * 100).toFixed(1)}%`;
                document.getElementById('riskLevel').textContent = result.risk_level.replace('_', ' ');
                document.getElementById('riskLabel').textContent = result.risk_label;
                
                // Update clinical note
                document.getElementById('clinicalNote').textContent = result.clinical_note;
                
                // Show abnormal values
                const abnormal = checkAbnormalValues(payload);
                displayNotes(abnormal);

            } catch (error) {
                loading.style.display = 'none';
                errorMessage.style.display = 'block';
                errorMessage.textContent = "‚ùå Error: " + error.message;
            }
        });

        document.querySelector('.btn-reset').addEventListener('click', () => {
            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('abnormalValues').classList.add("hidden");
            document.getElementById('showDetailsBtn').style.display = "none";
        });

        // Load low risk example on page load
        window.addEventListener('load', () => {
            // Optional: Load a default example
            // fillExampleData();
        });
    </script>
</body>
</html>